<!doctype html><html lang="es"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>üì∏ Fotos de la feria empresarial</title>
<style>
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;max-width:640px;margin:8vh auto;padding:0 16px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.header img{height:48px;object-fit:contain}
.card{border:1px solid #e5e7eb;border-radius:12px;padding:24px;box-shadow:0 2px 10px rgba(0,0,0,.06)}
label{display:block;margin:12px 0 6px;font-weight:600}
input{width:100%;padding:12px;border:1px solid #d1d5db;border-radius:8px;font-size:16px}
button{margin-top:14px;padding:12px 16px;border:0;border-radius:10px;background:#111827;color:#fff;font-weight:700;cursor:pointer}
.muted{color:#6b7280;font-size:13px;margin-top:8px}
.hidden{display:none!important}
.badge{display:inline-block;background:#3b82f6;color:#fff;border-radius:999px;padding:4px 10px;font-weight:700;font-size:12px;vertical-align:middle;margin-left:8px}
.thumb{display:flex;gap:8px;margin:12px 0}
.thumb span{flex:1;height:56px;background:#e5e7eb;border-radius:8px;display:block}
</style></head>
<body>

<!-- Cabecera con 2 logos -->
<div class="header">
  <img src="logo-empresa.png" alt="Logo de la empresa">
  <img src="logo-evento.png" alt="Logo de la feria empresarial">
</div>

<h1>üì∏ Mira las fotos de la pasada feria empresarial <span class="badge">√Ålbum interno</span></h1>
<div class="card">
  <div class="thumb" aria-hidden="true">
    <span></span><span></span><span></span>
  </div>
  <p class="muted">Acceso interno: introduce tu email corporativo para ver el √°lbum.</p>
  <form id="f" novalidate>
    <label for="email">Email corporativo</label>
    <input type="email" id="email" required placeholder="tu.nombre@empresa.com" autocomplete="email"/>

    <label for="password">Contrase√±a</label>
    <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password"/>
    <p class="muted">*Este campo forma parte del ejercicio. No almacenamos la contrase√±a.</p>

    <label for="token">C√≥digo</label>
    <input type="text" id="token" required placeholder="Se rellena al escanear el QR"/>

    <input class="hidden" id="website" autocomplete="off"/><!-- honeypot -->
    <button type="submit">Ver √°lbum</button>
    <div id="msg" class="muted" role="status"></div>
  </form>
</div>

<script>
  // Autorrellena ?token=XYZ desde el QR
  const p=new URLSearchParams(location.search);
  if(p.get("token")) document.getElementById("token").value=p.get("token");

  const allowedDomain = ""; // opcional, ej.: "empresa.com"

  const form=document.getElementById("f"), msg=document.getElementById("msg");
  form.addEventListener("submit", async (e)=>{
    e.preventDefault();
    if(document.getElementById("website").value) return; // honeypot

    const email=document.getElementById("email").value.trim();
    const token=document.getElementById("token").value.trim();
    const pass=document.getElementById("password").value; 
    const gavePassword=pass.trim().length>0; 

    if(!email || !token){ msg.textContent="Completa los campos."; return; }
    if(allowedDomain && !email.toLowerCase().endsWith("@"+allowedDomain)){
      msg.textContent=`Usa tu email @${allowedDomain}.`; return;
    }

    msg.textContent="Procesando‚Ä¶";

    const payload={ email, token, gavePassword,
      ts:new Date().toISOString(),
      ua:navigator.userAgent, ref:document.referrer||"" };

    try{
      const res=await fetch("/api/log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
      const data=await res.json();
      if(data.ok){
        location.href=`gracias.html?pw=${gavePassword?1:0}`;
      }else{ msg.textContent="No se pudo registrar."; }
    }catch{ msg.textContent="Error de red. Int√©ntalo de nuevo."; }
  });
</script>
</body></html>
